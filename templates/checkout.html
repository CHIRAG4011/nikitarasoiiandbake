{% extends "base.html" %}

{% block title %}Checkout - NIKITA RASOI & BAKES{% endblock %}

{% block content %}
<div class="container py-5">
    <h2 class="text-brown mb-4">
        <i class="fas fa-credit-card me-2"></i>Checkout
    </h2>
    
    <div class="row">
        <div class="col-lg-8">
            <form method="post" action="{{ url_for('place_order') }}">
                <!-- Shipping Address -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-map-marker-alt me-2"></i>Delivery Address</h5>
                    </div>
                    <div class="card-body">
                        {% if addresses %}
                        <div class="mb-3">
                            <label class="form-label">Select Saved Address:</label>
                            {% for address in addresses %}
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="address_id" 
                                       value="{{ address.id }}" id="address{{ address.id }}">
                                <label class="form-check-label" for="address{{ address.id }}">
                                    <strong>{{ address.name }}</strong><br>
                                    {{ address.street }}<br>
                                    {{ address.city }}, {{ address.state }} {{ address.zip_code }}<br>
                                    <small class="text-muted">{{ address.phone }}</small>
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        <hr>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="address_type" 
                                   value="new" id="newAddress" onclick="toggleNewAddress()">
                            <label class="form-check-label" for="newAddress">
                                Use a different address
                            </label>
                        </div>
                        {% endif %}
                        
                        <div id="newAddressForm" {% if not addresses %}{% else %}style="display:none;"{% endif %}>
                            <div class="mb-3">
                                <label for="new_address" class="form-label">Full Address <span class="text-danger">*</span></label>
                                <textarea class="form-control" id="new_address" name="new_address" rows="3"
                                          placeholder="Enter your complete delivery address including name, street, city, state, and PIN code" 
                                          {% if not addresses %}required{% endif %}></textarea>
                                <div class="form-text">Please provide your complete delivery address including all necessary details.</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Information -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-credit-card me-2"></i>Payment Method</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Secure payment powered by Razorpay. All major payment methods accepted.
                        </div>
                        
                        <!-- Payment Method Selection -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <label class="form-label">Select Payment Method:</label>
                                <div class="payment-methods">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="radio" name="payment_method" value="razorpay" id="razorpay" checked>
                                        <label class="form-check-label" for="razorpay">
                                            <i class="fas fa-credit-card me-2"></i>Card/UPI/NetBanking/Wallets
                                            <small class="d-block text-muted">Visa, Mastercard, UPI, Google Pay, PhonePe, Paytm & more</small>
                                        </label>
                                    </div>
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="radio" name="payment_method" value="cash_on_delivery" id="cash_on_delivery">
                                        <label class="form-check-label" for="cash_on_delivery">
                                            <i class="fas fa-money-bill-wave me-2 text-success"></i>Cash on Delivery
                                            <small class="d-block text-muted">Pay when your order arrives</small>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Razorpay Payment Details -->
                        <div id="razorpay_details" class="payment-details">
                            <div class="alert alert-success">
                                <i class="fas fa-shield-alt me-2"></i>
                                You will be redirected to secure Razorpay payment page after clicking "Place Order".
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="mb-2">Accepted Payment Methods:</h6>
                                    <ul class="list-unstyled small">
                                        <li><i class="fas fa-check text-success me-2"></i>Credit & Debit Cards</li>
                                        <li><i class="fas fa-check text-success me-2"></i>UPI (Google Pay, PhonePe, etc.)</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Net Banking</li>
                                        <li><i class="fas fa-check text-success me-2"></i>Digital Wallets</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="mb-2">Security Features:</h6>
                                    <ul class="list-unstyled small">
                                        <li><i class="fas fa-lock text-primary me-2"></i>256-bit SSL Encryption</li>
                                        <li><i class="fas fa-shield-alt text-primary me-2"></i>PCI DSS Compliant</li>
                                        <li><i class="fas fa-check-circle text-success me-2"></i>RBI Approved</li>
                                        <li><i class="fas fa-users text-info me-2"></i>Trusted by 8M+ businesses</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Cash on Delivery Details -->
                        <div id="cash_delivery_details" class="payment-details" style="display: none;">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                Payment will be collected upon delivery. Please have exact change ready.
                            </div>
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Additional ₹20 handling charges apply for Cash on Delivery orders.
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Special Instructions -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0"><i class="fas fa-comment me-2"></i>Special Instructions</h5>
                    </div>
                    <div class="card-body">
                        <textarea class="form-control" rows="3" placeholder="Any special delivery instructions or notes..."></textarea>
                    </div>
                </div>
                
                <button type="button" class="btn btn-brown btn-lg" id="placeOrderBtn" onclick="initiatePayment()">
                    <i class="fas fa-shopping-bag me-2"></i>
                    <span id="buttonText">Place Order</span>
                    <span id="buttonSpinner" class="spinner-border spinner-border-sm ms-2" style="display: none;"></span>
                </button>
            </form>
        </div>
        
        <div class="col-lg-4">
            <!-- Order Summary -->
            <div class="card">
                <div class="card-header bg-brown text-white">
                    <h5 class="mb-0">Order Summary</h5>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Items ({{ cart_count }}):</span>
                        <span>₹{{ "%.2f"|format(cart_total) }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Delivery Fee:</span>
                        <span>₹50.00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Tax (18%):</span>
                        <span>₹{{ "%.2f"|format((cart_total + 50.00) * 0.18) }}</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total:</strong>
                        <strong class="text-brown">₹{{ "%.2f"|format((cart_total + 50.00) * 1.18) }}</strong>
                    </div>
                </div>
            </div>
            
            <!-- Security Notice -->
            <div class="card mt-3">
                <div class="card-body">
                    <h6 class="card-title"><i class="fas fa-shield-alt me-2"></i>Secure Checkout</h6>
                    <ul class="list-unstyled small">
                        <li><i class="fas fa-check text-success me-2"></i>SSL encrypted</li>
                        <li><i class="fas fa-check text-success me-2"></i>PCI compliant</li>
                        <li><i class="fas fa-check text-success me-2"></i>Money-back guarantee</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Success Modal -->
<div class="modal fade" id="paymentSuccessModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title">
                    <i class="fas fa-check-circle me-2"></i>Payment Successful!
                </h5>
            </div>
            <div class="modal-body text-center">
                <div class="mb-4">
                    <i class="fas fa-check-circle text-success" style="font-size: 4rem;"></i>
                </div>
                <h4 class="text-success mb-3">Order Placed Successfully!</h4>
                <p class="text-muted mb-4">Thank you for your order. You will receive a confirmation email shortly.</p>
                <div id="orderDetails" class="alert alert-light">
                    <strong>Order #<span id="orderNumber"></span></strong><br>
                    <small class="text-muted">Track your order in the "My Orders" section</small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-brown" onclick="window.location.href='/'">Continue Shopping</button>
                <button type="button" class="btn btn-outline-brown" id="viewOrderBtn">View Order</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<!-- Razorpay SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
// Razorpay Payment Integration
function initiatePayment() {
    const button = document.getElementById('placeOrderBtn');
    const buttonText = document.getElementById('buttonText');
    const spinner = document.getElementById('buttonSpinner');
    
    // Validate address selection
    if (!validateAddress()) {
        alert('Please select or enter a delivery address.');
        return;
    }
    
    // Show loading state
    button.disabled = true;
    buttonText.textContent = 'Processing...';
    spinner.style.display = 'inline-block';
    
    // Get form data
    const form = document.querySelector('form');
    const formData = new FormData(form);
    
    // Create payment order
    fetch('/create_payment_order', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (!data.success) {
            throw new Error(data.error || 'Failed to create payment order');
        }
        
        // Handle Cash on Delivery
        if (data.cash_order) {
            showSuccessMessage(data.message, data.order_id);
            return;
        }
        
        // Initialize Razorpay payment
        initializeRazorpayPayment(data);
    })
    .catch(error => {
        console.error('Payment Error:', error);
        alert('Error: ' + error.message);
    })
    .finally(() => {
        // Reset button state
        button.disabled = false;
        buttonText.textContent = 'Place Order';
        spinner.style.display = 'none';
    });
}

function initializeRazorpayPayment(orderData) {
    const options = {
        key: orderData.key,
        amount: orderData.amount,
        currency: orderData.currency,
        name: orderData.name,
        description: orderData.description,
        order_id: orderData.order_id,
        prefill: orderData.prefill,
        theme: {
            color: '#8B4513' // Brown theme matching bakery
        },
        handler: function(response) {
            // Payment successful, verify on server
            verifyPayment(response);
        },
        modal: {
            ondismiss: function() {
                console.log('Payment modal dismissed');
                // Payment was closed/cancelled
                alert('Payment cancelled. You can retry the payment anytime.');
            }
        }
    };
    
    const rzp = new Razorpay(options);
    rzp.open();
}

function verifyPayment(paymentResponse) {
    const formData = new FormData();
    formData.append('razorpay_payment_id', paymentResponse.razorpay_payment_id);
    formData.append('razorpay_order_id', paymentResponse.razorpay_order_id);
    formData.append('razorpay_signature', paymentResponse.razorpay_signature);
    
    fetch('/verify_payment', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            showSuccessMessage(data.message, data.order_id);
        } else {
            throw new Error(data.error || 'Payment verification failed');
        }
    })
    .catch(error => {
        console.error('Verification Error:', error);
        alert('Payment verification failed: ' + error.message);
        // Show contact support message
        alert('Please contact our support team with your payment ID: ' + paymentResponse.razorpay_payment_id);
    });
}

function showSuccessMessage(message, orderId) {
    // Show success modal instead of alert
    document.getElementById('orderNumber').textContent = orderId;
    
    // Set up view order button
    document.getElementById('viewOrderBtn').onclick = function() {
        window.location.href = '/order_tracking/' + orderId;
    };
    
    // Show the modal
    const successModal = new bootstrap.Modal(document.getElementById('paymentSuccessModal'));
    successModal.show();
}

function validateAddress() {
    const addressId = document.querySelector('input[name="address_id"]:checked');
    const newAddress = document.getElementById('new_address');
    
    if (addressId) {
        return true;
    }
    
    if (newAddress && newAddress.value.trim()) {
        return true;
    }
    
    return false;
}

// Handle payment method changes
document.addEventListener('DOMContentLoaded', function() {
    const paymentMethods = document.querySelectorAll('input[name="payment_method"]');
    const razorpayDetails = document.getElementById('razorpay_details');
    const cashDetails = document.getElementById('cash_delivery_details');
    
    paymentMethods.forEach(method => {
        method.addEventListener('change', function() {
            if (this.value === 'razorpay') {
                razorpayDetails.style.display = 'block';
                cashDetails.style.display = 'none';
            } else if (this.value === 'cash_on_delivery') {
                razorpayDetails.style.display = 'none';
                cashDetails.style.display = 'block';
            }
        });
    });
    
    // Initialize with default selection
    const defaultMethod = document.querySelector('input[name="payment_method"]:checked');
    if (defaultMethod) {
        defaultMethod.dispatchEvent(new Event('change'));
    }
});

    handleOrderSubmission() {
        // Validate address first
        if (!this.validateAddress()) {
            return;
        }
        
        const selectedMethod = document.querySelector('input[name="payment_method"]:checked').value;
        const digitalMethods = ['paypal', 'apple_pay', 'google_pay', 'crypto', 'bank_transfer'];
        
        if (digitalMethods.includes(selectedMethod)) {
            this.showQRVerification(selectedMethod);
        } else {
            this.submitOrder();
        }
    }

    validateAddress() {
        const addressRadios = document.querySelectorAll('input[name="address_id"]');
        const newAddressField = document.getElementById('new_address');
        
        let hasSelectedAddress = false;
        
        // Check if any saved address is selected
        addressRadios.forEach(radio => {
            if (radio.checked) {
                hasSelectedAddress = true;
            }
        });
        
        // Check if new address is provided when "Use different address" is selected
        const useNewAddress = document.getElementById('newAddress');
        if (useNewAddress && useNewAddress.checked) {
            if (!newAddressField.value.trim()) {
                alert('Please enter a delivery address.');
                newAddressField.focus();
                return false;
            }
            hasSelectedAddress = true;
        }
        
        // If no addresses exist and new address field is empty
        if (!hasSelectedAddress && (!newAddressField.value || !newAddressField.value.trim())) {
            alert('Please provide a delivery address to continue.');
            if (newAddressField) {
                newAddressField.focus();
            }
            return false;
        }
        
        return true;
    }

    showQRVerification(paymentMethod) {
        // Update modal title with payment method
        document.querySelector('#qrVerificationModal .modal-title').innerHTML = 
            `<i class="fas fa-qrcode me-2"></i>${this.getPaymentMethodName(paymentMethod)} Verification`;
        
        // Reset modal state
        document.getElementById('qrCodeContainer').style.display = 'block';
        document.getElementById('screenshotUpload').style.display = 'none';
        document.getElementById('paymentStatus').style.display = 'none';
        document.getElementById('qrActions').style.display = 'block';
        document.getElementById('uploadActions').style.display = 'none';
        document.getElementById('processingActions').style.display = 'none';
        
        // Show modal and start timer
        this.qrModal.show();
        this.generateQRCode();
        this.startQRTimer();
    }

    generateQRCode() {
        const canvas = document.getElementById('qrCanvas');
        const ctx = canvas.getContext('2d');
        
        // Clear canvas
        ctx.clearRect(0, 0, 200, 200);
        
        // Generate simple QR-like pattern (demo)
        ctx.fillStyle = '#000';
        for (let i = 0; i < 20; i++) {
            for (let j = 0; j < 20; j++) {
                if (Math.random() > 0.5) {
                    ctx.fillRect(i * 10, j * 10, 10, 10);
                }
            }
        }
        
        // Add corner markers
        this.drawCornerMarker(ctx, 0, 0);
        this.drawCornerMarker(ctx, 140, 0);
        this.drawCornerMarker(ctx, 0, 140);
        
        // Add center circle
        ctx.beginPath();
        ctx.arc(100, 100, 15, 0, 2 * Math.PI);
        ctx.fill();
    }

    drawCornerMarker(ctx, x, y) {
        ctx.fillStyle = '#000';
        ctx.fillRect(x, y, 60, 60);
        ctx.fillStyle = '#fff';
        ctx.fillRect(x + 10, y + 10, 40, 40);
        ctx.fillStyle = '#000';
        ctx.fillRect(x + 20, y + 20, 20, 20);
    }

    startQRTimer() {
        this.qrTimeLeft = 120;
        this.updateTimerDisplay();
        
        this.qrTimer = setInterval(() => {
            this.qrTimeLeft--;
            this.updateTimerDisplay();
            
            if (this.qrTimeLeft <= 0) {
                this.handleQRTimeout();
            }
        }, 1000);
    }

    updateTimerDisplay() {
        const minutes = Math.floor(this.qrTimeLeft / 60);
        const seconds = this.qrTimeLeft % 60;
        const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        document.getElementById('qrTimer').textContent = timeString;
        
        // Change color as time runs out
        const timerElement = document.getElementById('qrTimer');
        if (this.qrTimeLeft <= 30) {
            timerElement.className = 'badge bg-danger fs-6';
        } else if (this.qrTimeLeft <= 60) {
            timerElement.className = 'badge bg-warning fs-6';
        }
    }

    handleQRTimeout() {
        clearInterval(this.qrTimer);
        
        // Hide QR code and show screenshot upload
        document.getElementById('qrCodeContainer').style.display = 'none';
        document.getElementById('screenshotUpload').style.display = 'block';
        document.getElementById('qrActions').style.display = 'none';
        document.getElementById('uploadActions').style.display = 'block';
    }

    handleScreenshotUpload(e) {
        const file = e.target.files[0];
        if (file) {
            if (file.size > 5 * 1024 * 1024) { // 5MB limit
                alert('File size must be less than 5MB');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('screenshotPreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    }

    submitScreenshot() {
        const file = document.getElementById('paymentScreenshot').files[0];
        if (!file) {
            alert('Please select a screenshot to upload');
            return;
        }
        
        // Simulate upload process
        this.showLoadingState('Verifying screenshot...');
        
        setTimeout(() => {
            document.getElementById('screenshotUpload').style.display = 'none';
            document.getElementById('paymentStatus').style.display = 'block';
            document.getElementById('uploadActions').style.display = 'none';
            document.getElementById('processingActions').style.display = 'block';
        }, 2000);
    }

    completeOrder() {
        this.closeQRModal();
        this.submitOrder();
    }

    closeQRModal() {
        if (this.qrTimer) {
            clearInterval(this.qrTimer);
        }
        this.qrModal.hide();
    }

    submitOrder() {
        const form = document.querySelector('form');
        const formData = new FormData(form);
        
        // Add payment method info
        const paymentMethod = document.querySelector('input[name="payment_method"]:checked').value;
        formData.append('payment_method', paymentMethod);
        
        // Show loading state
        this.showLoadingState('Processing your order...');
        
        // Submit with AJAX to prevent page reload
        fetch('/place_order', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.text();
            }
            throw new Error('Order submission failed');
        })
        .then(html => {
            // Parse response to check for success/error
            if (html.includes('Order #') && html.includes('placed successfully')) {
                // Clear the cart display immediately
                this.clearCartDisplay();
                this.showSuccessMessage('Order placed successfully!');
                setTimeout(() => {
                    window.location.href = '/orders';
                }, 2000);
            } else {
                // Parse and show any error messages
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const alerts = doc.querySelectorAll('.alert-danger');
                if (alerts.length > 0) {
                    this.showErrorMessage(alerts[0].textContent.trim());
                } else {
                    window.location.reload();
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            this.showErrorMessage('Failed to place order. Please try again.');
        })
        .finally(() => {
            this.hideLoadingState();
        });
    }

    showLoadingState(message) {
        const btn = document.getElementById('placeOrderBtn');
        btn.innerHTML = `<i class="fas fa-spinner fa-spin me-2"></i>${message}`;
        btn.disabled = true;
    }

    hideLoadingState() {
        const btn = document.getElementById('placeOrderBtn');
        btn.innerHTML = '<i class="fas fa-shopping-bag me-2"></i>Place Order';
        btn.disabled = false;
    }

    showSuccessMessage(message) {
        this.showNotification(message, 'success');
    }

    showErrorMessage(message) {
        this.showNotification(message, 'danger');
    }

    clearCartDisplay() {
        // Update cart count in navbar
        const cartBadge = document.querySelector('.navbar .badge');
        if (cartBadge) {
            cartBadge.textContent = '0';
            cartBadge.style.display = 'none';
        }
        
        // Update cart total display
        const cartTotalElements = document.querySelectorAll('.cart-total');
        cartTotalElements.forEach(element => {
            element.textContent = '₹0.00';
        });
        
        // Update cart count display
        const cartCountElements = document.querySelectorAll('.cart-count');
        cartCountElements.forEach(element => {
            element.textContent = '0';
        });
    }

    showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 5000);
    }

    getPaymentMethodName(method) {
        const names = {
            'paypal': 'PayPal',
            'apple_pay': 'Apple Pay',
            'google_pay': 'Google Pay',
            'crypto': 'Cryptocurrency',
            'bank_transfer': 'Bank Transfer'
        };
        return names[method] || method;
    }

    toggleNewAddress() {
        const newAddressForm = document.getElementById('newAddressForm');
        const newAddressRadio = document.getElementById('newAddress');
        
        if (newAddressRadio.checked) {
            newAddressForm.style.display = 'block';
            document.querySelectorAll('input[name="address_id"]').forEach(radio => {
                radio.checked = false;
            });
        } else {
            newAddressForm.style.display = 'none';
        }
    }

    initializeCardFormatting() {
        // Format card number
        const cardNumber = document.getElementById('cardNumber');
        if (cardNumber) {
            cardNumber.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
                let formattedValue = value.match(/\d{1,4}/g)?.join(' ') || value;
                e.target.value = formattedValue;
            });
        }

        // Format expiry date
        const expiry = document.getElementById('expiry');
        if (expiry) {
            expiry.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length >= 2) {
                    value = value.substring(0, 2) + '/' + value.substring(2, 4);
                }
                e.target.value = value;
            });
        }

        // CVV validation
        const cvv = document.getElementById('cvv');
        if (cvv) {
            cvv.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/\D/g, '').substring(0, 4);
            });
        }
    }

    initializePaymentMethods() {
        // Set initial payment method display
        const selectedMethod = document.querySelector('input[name="payment_method"]:checked');
        if (selectedMethod) {
            this.handlePaymentMethodChange({ target: selectedMethod });
        }
    }
}

// Initialize checkout manager when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
    window.checkoutManager = new CheckoutManager();
});

// Legacy functions for compatibility
function toggleNewAddress() {
    if (window.checkoutManager) {
        window.checkoutManager.toggleNewAddress();
    }
}
</script>
{% endblock %}
